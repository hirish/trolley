// Generated by CoffeeScript 1.6.3
var Ingredient, Ingredients, Recipe, Recipes;

Ingredient = Backbone.Model.extend({
  defaults: {
    name: null,
    value: 0,
    amountRequired: 0,
    amountRequiredUnit: 'g'
  }
});

Ingredients = Backbone.Collection.extend({
  model: Ingredient
});

Recipe = Backbone.Model.extend({
  defaults: {
    name: null,
    ingredients: new Ingredients,
    url: null
  }
});

Recipes = Backbone.Collection.extend({
  model: Recipe
});

$(function() {
  var createRecipeFromJSON, errorBox, errorHandler, errorTemplate, renderSearchResult, search, searchBox, searchResultHandler, searchResultTemplate, searchResultsBox, throttledSearch, userId;
  window.userId = userId = 1;
  searchBox = $('#search');
  searchResultsBox = $('#searchResults');
  errorBox = $('#error');
  errorTemplate = $('#errorTemplate').html();
  searchResultTemplate = $('#searchResultTemplate').html();
  search = function(e) {
    var searchText;
    searchText = searchBox.val();
    return $.ajax("/" + userId + "/search?q=" + searchText, {
      success: searchResultHandler,
      error: errorHandler
    });
  };
  throttledSearch = _.throttle(search, 250);
  renderSearchResult = function(result) {
    console.log("****RENDERING****");
    console.log(result);
    return _.template(searchResultTemplate, {
      name: result.get('name'),
      url: result.get('url')
    });
  };
  searchResultHandler = function(jsonResults) {
    var recipeResult, recipeResults, renderedResult, renderedResults, result, results, _i, _len, _results;
    results = [$.parseJSON(jsonResults).results];
    recipeResults = (function() {
      var _i, _len, _results;
      _results = [];
      for (_i = 0, _len = results.length; _i < _len; _i++) {
        result = results[_i];
        _results.push(createRecipeFromJSON(result));
      }
      return _results;
    })();
    console.log(recipeResults);
    renderedResults = (function() {
      var _i, _len, _results;
      _results = [];
      for (_i = 0, _len = recipeResults.length; _i < _len; _i++) {
        recipeResult = recipeResults[_i];
        _results.push(renderSearchResult(recipeResult));
      }
      return _results;
    })();
    searchResultsBox.html('');
    _results = [];
    for (_i = 0, _len = renderedResults.length; _i < _len; _i++) {
      renderedResult = renderedResults[_i];
      _results.push(searchResultsBox.append(renderedResult));
    }
    return _results;
  };
  createRecipeFromJSON = function(jsonRecipe) {
    return new Recipe({
      name: "Spaghetti Bolognese",
      url: "http://upload.wikimedia.org/wikipedia/commons/e/e5/Heston_Blumenthal's_Perfect_Spaghetti_Bolognese.jpg"
    });
  };
  errorHandler = function(reqObj) {
    var renderedTemplate;
    renderedTemplate = _.template(errorTemplate, {
      statusCode: 404
    });
    return errorBox.html(renderedTemplate);
  };
  return searchBox.keyup(throttledSearch);
});
